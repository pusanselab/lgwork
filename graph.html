<!DOCTYPE html>
<html>
    <header>
        <title>LG Air Data Virtualization</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/login.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    </header>
    <body>
        <div id="sub">
            <h1> ■ 그래프 추가</h1>
            Unit : <select id="unit" onchange="itemChange()">
                <option value="notting" selected disabled hidden>==선택하세요==</option>
                <option value="ODU">ODU</option>
                <option value="IDU">IDU</option>
                <option value="HRU">HRU</option>
                <option value="Calorimeter">Calorimeter</option>
                <option value="DXC">DXC</option>
                <option value="AWHP">AWHP</option>
                <option value="SHOWCASE">SHOWCASE</option>
                <option value="FAU">FAU</option>
                <option value="WHU">WHU</option>
                <option value="CASCADE">CASCADE</option>
                

            </select>
            Index : <select id="index">
                
            </select>
            <button class="button" style="margin: 10px" onClick='SelectUnit()'>선택</button>

        </div>
        <div id="table">
                <table id="detail_table" class="table table-striped table-bordered table-hover table-condensed">
                <tbody id="detail_body">
                    <tr>
                    <td>Unit 명칭</td>
                    <td>Unit Index</td>
                    <td>삭제 버튼</td>
                </tr>
            </tbody>
            </table>

            <button class='button'>그래프 보기</button>

        </div>
        <div id="graph">
            <div id="realgraph">

            </div>
            <div id="selectgraph">
                <form id="selectform">
                    
                </form>

            </div>

        </div>
        <span></span>
    </body>



    <!--Script-->

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/jquery.dropotron.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> 
    <script src="https://d3js.org/d3-array.v2.min.js"></script>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-format.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://d3js.org/d3-time.v1.min.js"></script>
    <script src="https://d3js.org/d3-time-format.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale.v3.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>

            $(document).ready(function(){
                var val = location.href.substr(
                location.href.lastIndexOf('=') + 1);
				console.log("enter login");
                var params="header_uid="+val;
				$.ajax({
					type: 'post'
					, url: 'http://localhost:3000/api/data_search_id'
					, data: params
					, beforeSend: function() {
						$('#ajax_load_indicator').show().fadeIn('fast'); 
					}
					, success: function(data) {
                        var element = data.content;
                            var odu_count = element.lgmv_odu_count;
                            var cal_count = element.calorimeter_count;
                            var dxc_count = element.lgmv_sidu_dxc_count;
                            var hru_count = element.lgmv_hru_count;
                            var idu_count = element.lgmv_idu_count;
                            var awhp_count = element.lgmv_sidu_awhp_count;
                            var showcase_count = element.lgmv_sidu_showcase_count;
                            var fau_count = element.lgmv_sidu_fau_count;
                            var whu_count = element.lgmv_sidu_whu_count;
                            var cascade_count = element.lgmv_sidu_cascade_count;
                            


                            $("span").data("odu",odu_count);
                            $("span").data("cal",cal_count);
                            $("span").data("dxc",dxc_count);
                            $("span").data("hru",hru_count);
                            $("span").data("idu",idu_count);
                            $("span").data("awhp",awhp_count);
                            $("span").data("showcase",showcase_count);
                            $("span").data("fau",fau_count);
                            $("span").data("whu",whu_count);
                            $("span").data("cascade",cascade_count);


							
						}
						, error: function(data, status, err) {
							console.log("error forward : "+data);
							alert('서버와의 통신이 실패했습니다.');
						}
						, complete: function() { 
							$('#ajax_load_indicator').fadeOut();
						}
					});
				});

                function itemChange(){

                    var odu_count=$("span").data("odu");
                    var cal_count=$("span").data("cal");
                    var dxc_count=$("span").data("dxc");
                    var hru_count= $("span").data("hru");
                    var idu_count=$("span").data("idu");
                    var awhp_count=$("span").data("awhp");
                    var showcase_count=$("span").data("showcase");
                    var fau_count =$("span").data("fau");
                    var whu_count=$("span").data("whu");
                    var cascade_count = $("span").data("cascade");

                    

                    var unit_select=$("#unit").val();
                    var change_index;
                    $('#index').empty();
                    if(unit_select=="ODU"){
                        if(odu_count==0){
                            $('#index').empty();;
                        }
                        for(var i =1; i<=odu_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }

                    else if(unit_select=="Calorimeter"){
                        if(cal_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=cal_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }

                    else if(unit_select=="DXC"){
                        if(dxc_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=dxc_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="IDU"){
                        if(idu_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=idu_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="HRU"){
                        if(hru_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=hru_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="AWHP"){
                        if(awhp_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=awhp_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="SHOWCASE"){
                        if(showcase_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=showcase_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="FAU"){
                        if(fau_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=fau_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="WHU"){
                        if(whu_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=whu_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    
                    }
                    else if(unit_select=="CASCADE"){
                        if(cascade_count==0){
                            $('#index').empty();
                        }
                        for(var i =1; i<=cascade_count;i++){
                            var option=$("<option value=\""+i+"\">"+i+"</option>");
                            $('#index').append(option);
                        }
                    }
                }

                function SelectUnit(){
                    
                    var first=$("#unit").val()
                    var second = $("#index").val()
                    var table_row = $('#detail_body tr').length;

                    if(table_row>5){
                        alert("5개 까지 선택 가능합니다.");
                    }
                    else if($('#index').val()==undefined){
                        alert("값이 존재하는 것만 가능합니다.");

                    }
                    else{
                        var button = "<button class='button' onclick='removeUnit(this)'>삭제</button>";
                        var row = "<tr>";
                        row+="<td>"+first+"</td>";
                        row+="<td>"+second+"</td>";
                        row+="<td>"+button+"</td>";
                        row+="</tr>"

                        $('#detail_body').append(row);
                    }
                }

                function removeUnit(obj){
                    var remove = $(obj).parent().parent();
                    remove.remove(); 
                }

                function showGraph(){
                   var table_length= $('detail_body tr').lenght
                   for(var i=1; i<table_length;i++){
                       var htmltest = "<div class=\"col-md-"+table_length+"\">";
                       htmltest+="<h1 class='h1'>"+$('#detail_body tr eq('+i+') td(0)').val()+" "+$('#detail_body tr eq('+i+') td(1)').val()+"</h1>";
                       $('#selectform').append(htmltest)
                   }
                }
                        

    </script>
</html>